# 更新说明

## [v1.2.0] 2026-02-16（三项核心 Bug 修复）
- **计时不准确修复**：
  - 拦截触发后的冷却期/抑制期（最长 20 秒）不再跳过时间累加，只跳过拦截触发。
  - 修复"看了 1 分 14 秒视频，app 的 1 分钟计时还没到"的问题。
- **拦截后关闭短视频应用**：
  - 拦截回桌面后自动调用 `killBackgroundProcesses()` 杀死短视频 app 后台进程。
  - 新增 `KILL_BACKGROUND_PROCESSES` 权限声明。
- **行为检测误判修复**：
  - 过滤文本编辑类控件（EditText/Editor/Input）产生的滚动事件，打字不再被误判为刷短视频。
  - 行为判定阈值从"12 秒内 3 次滚动"提高到"8 秒内 5 次滚动"，大幅降低误判率。
- **涉及文件**：`LimitMonitor.kt`、`ShortVideoAccessibilityService.kt`、`ShortVideoBehaviorSignals.kt`、`AndroidManifest.xml`

## [v1.1.0] 2026-02-16（Bug 修复 + Release 签名）
- **关键 Bug 修复**：
  - 修复"识别并填入当前应用名"按钮会覆盖整个目标列表的严重 Bug，现在改为追加。
  - 修复拦截遮罩 `addView` 失败后拦截功能永久失效的问题（需重启 App 才恢复）。
  - 修复遮罩 `hide()` 时 `removeView` 可能抛异常导致 App 崩溃。
- **拦截 UI 适配修复**：
  - 拦截卡片宽度从硬编码 800px 改为 300dp 密度自适应，所有间距/圆角统一使用 dp 单位。
- **稳定性增强**：
  - LimitMonitor 改用 applicationContext，避免 Service Context 泄漏。
  - LimitForegroundService 新增 `onStartCommand()` 显式返回 `START_STICKY`，增强被系统杀后自动重启的可靠性。
  - 无障碍服务 XML 补全 `typeWindowsChanged` 事件声明，修复部分设备上前台包名检测不准的问题。
- **Release 签名配置**：
  - 新增 release 签名配置，解决 vivo 等机型安装 debug APK 时需要"解除设置限制"的问题。
  - 构建命令：`JAVA_HOME="E:/Java/JDK17" ./gradlew :app:assembleRelease`
  - 输出路径：`android/app/build/outputs/apk/release/app-release.apk`
- **版本号更新**：`versionCode = 11`, `versionName = "1.1.0"`。

## [v1.0.0] 2026-02-16（正式版）
- **视觉系统全面升级**：
  - 采用全新的原创二次元动漫风格矢量图标，彻底解决旧图标在 vivo 等机型上的拉伸变形问题。
  - 采用全矢量方案，确保在任何分辨率下都清晰丝滑且无版权风险。
  - 优化自适应图标背景，采用梦幻天蓝色渐变。
- **拦截 UI 深度优化**：
  - 将原有的全屏黑幕拦截改为现代化的圆角卡片对话框样式。
  - 新增“警示名言”功能：在拦截时随机展示一条关于专注或时间管理的名言，引导用户自省。
  - 优化倒计时显示与排版，提升视觉高级感。
- **工程质量与版本**：
  - 修复了资源文件冲突导致的编译错误。
  - 版本号更新：`versionCode = 10`, `versionName = "1.0.0"`。

## [v0.9.0] 2026-02-16
- 调整更新记录排序为降序：最新记录放在最上方。
- 约定维护规则：后续尽量只追加；若需要“最新在上”，使用顶部插入新节，不删除历史记录。
- 版本号更新：
  - `versionCode = 9`
  - `versionName = "0.9.0"`
  - 文件：`android/app/build.gradle`
- 限制逻辑修复：
  - 前台识别增加多重兜底（无障碍实时包名 + UsageEvents + UsageStats）。
  - 修复“同一 App 连续刷时偶发不触发”的问题。
  - 增加冷却窗口和同包名抑制，减少回桌面后的重复弹遮罩。
  - Reduce 在前台配置时暂停拦截，避免设置过程被打断。
- 判定策略优化：
  - 行为模式增加目标应用兜底，减少漏判。
  - 关闭行为模式时，要求至少配置一个目标应用。
- 系统设置引导增强：
  - 增加电池优化豁免状态显示与入口（提升 vivo 等机型稳定性）。
- 界面与资源更新：
  - 主界面改为分区卡片布局。
  - 目标应用改为下拉预设 + 添加所选。
  - 图标更换为新的 AI 动漫风版本（前景图 + mipmap 多密度资源）。

## [v0.1.0] 初始实现记录（历史整理）
- 基础功能：限制理由、限制时长、竖屏计时、超时后遮罩 + 5 秒倒计时 + 回桌面。
- 基础权限：使用情况访问、悬浮窗、无障碍。
- 基础工程：Android 可构建运行，生成 Debug APK。

## 文件变更（本次整理）
- 更新：`android/app/build.gradle`
- 更新：`android/app/src/main/java/com/reduce/app/MainActivity.kt`
- 更新：`android/app/src/main/java/com/reduce/app/LimitMonitor.kt`
- 更新：`android/app/src/main/java/com/reduce/app/SettingsStore.kt`
- 更新：`android/app/src/main/java/com/reduce/app/ShortVideoAccessibilityService.kt`
- 更新：`android/app/src/main/java/com/reduce/app/UsageUtils.kt`
- 更新：`android/app/src/main/java/com/reduce/app/PermissionUtils.kt`
- 更新：`android/app/src/main/res/values/strings.xml`
- 更新：`android/app/src/main/res/drawable/ic_launcher_foreground.png`
- 更新：`android/app/src/main/res/mipmap-*/ic_launcher*.png`
- 更新：`docs/用户手册.md`

## 安装包
- `android/app/build/outputs/apk/debug/app-debug.apk`
